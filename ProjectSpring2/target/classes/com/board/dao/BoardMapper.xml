<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  

<mapper namespace="Board">  
	<!-- 1. 글 목록보기 -->
	<select id="selectList" parameterType="map" resultType="BoardCommand">
		select qna_num,mem_id,qna_title,qna_content,qna_ref,qna_re_step,qna_re_level,qna_views,qna_date,qna_img,qna_authority
		from (
			select a.*,rownum rnum
			from(
				select * from qna
				<where>
					<if test="keyWord!=null and keyField=='qna_title'">
						qna_title like '%' || #{keyWord} || '%'
					</if>
					<if test="keyWord!=null and keyField=='qna_content'">
						qna_content like '%' || #{keyWord} || '%'
					</if>
					<if test="keyWord!=null and keyField=='mem_id'">
						mem_id like '%' || #{keyWord} || '%'
					</if>
				</where>
				order by qna_ref desc, qna_re_step asc
			) a
		)
		<![CDATA[
			where rnum >= #{start} and rnum <= #{end}
		]]>
	</select>
	
	<!-- 2. 검색어에 해당하는 총 레코드 수 구하기. -->
	<select id="selectCount" parameterType="map" resultType="Integer">
		select count(*) from qna
		<where>
					<if test="keyWord!=null and keyField=='qna_title'">
						qna_title like '%' || #{keyWord} || '%'
					</if>
					<if test="keyWord!=null and keyField=='qna_content'">
						qna_content like '%' || #{keyWord} || '%'
					</if>
					<if test="keyWord!=null and keyField=='mem_id'">
						mem_id like '%' || #{keyWord} || '%'
					</if>
		</where>
	</select>
	
</mapper>